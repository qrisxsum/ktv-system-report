/**
 * 分页组件移动端优化 Composable
 * 
 * 使用示例：
 * 
 * import { usePagination } from '@/composables/usePagination'
 * 
 * const { pageSizeOptions, paginationLayout, pagerCount } = usePagination({
 *   desktopPageSizes: [20, 50, 100],
 *   mobilePageSizes: [20, 50]
 * })
 * 
 * 在模板中使用：
 * <el-pagination
 *   :layout="paginationLayout"
 *   :page-sizes="pageSizeOptions"
 *   :pager-count="pagerCount"
 *   ...
 * />
 */

import { ref, computed, onMounted, onBeforeUnmount } from 'vue'

export function usePagination(options = {}) {
  const {
    desktopPageSizes = [20, 50, 100],
    mobilePageSizes = [20, 50]
  } = options

  // 响应式状态
  const isMobile = ref(false)
  const isSmallScreen = ref(false)

  // 检测设备类型
  const checkDevice = () => {
    isMobile.value = window.innerWidth <= 768
    isSmallScreen.value = window.innerWidth <= 480
  }

  // 计算属性：每页条数选项
  const pageSizeOptions = computed(() => {
    return isMobile.value ? mobilePageSizes : desktopPageSizes
  })

  // 计算属性：分页布局
  const paginationLayout = computed(() => {
    if (isSmallScreen.value) {
      return 'sizes, prev, pager, next'
    } else if (isMobile.value) {
      return 'total, sizes, prev, pager, next'
    } else {
      return 'total, sizes, prev, pager, next, jumper'
    }
  })

  // 计算属性：页码按钮数量
  const pagerCount = computed(() => {
    if (isSmallScreen.value) {
      return 3
    } else if (isMobile.value) {
      return 5
    } else {
      return 7
    }
  })

  // 生命周期：组件挂载时初始化
  onMounted(() => {
    checkDevice()
    window.addEventListener('resize', checkDevice)
  })

  // 生命周期：组件卸载时清理
  onBeforeUnmount(() => {
    window.removeEventListener('resize', checkDevice)
  })

  return {
    // 响应式状态（如果需要访问设备类型）
    isMobile,
    isSmallScreen,
    
    // 计算属性（直接用于 el-pagination）
    pageSizeOptions,
    paginationLayout,
    pagerCount,
    
    // 方法（如果需要手动触发检测）
    checkDevice
  }
}

