# Alembic 数据库迁移

本目录包含 KTV 经营分析系统的数据库迁移脚本。

## 常用命令

```bash
# 生成新的迁移脚本（自动检测模型变化）
alembic revision --autogenerate -m "描述信息"

# 执行所有待执行的迁移
#
# Windows 本地运行若遇到 alembic.ini UnicodeDecodeError（locale=GBK），可使用 ASCII-only 配置文件：
#   python -m alembic -c backend/alembic.ascii.ini upgrade head
alembic upgrade head

# 回滚到上一个版本
alembic downgrade -1

# 回滚到指定版本
alembic downgrade <revision_id>

# 查看当前版本
alembic current

# 查看迁移历史
alembic history

# 查看待执行的迁移
alembic heads
```

## 注意事项

1. 生成迁移前，确保所有模型都已导入到 `alembic/env.py`
2. 检查生成的迁移脚本，确保没有误删除操作
3. 生产环境执行迁移前，先在测试环境验证

