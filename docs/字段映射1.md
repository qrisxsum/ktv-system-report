# 字段映射文档

## 文档说明

本文档基于三个样例文件（预订汇总、酒水销售分析、包厢开台分析）生成，用于明确字段含义、数据类型、业务口径，为后续数据解析、清洗、入库提供标准映射规范。

**版本号**: v1.0  
**生成日期**: 2025-12-03  
**样例文件范围**: 
- 预订汇总：2025-11-03 至 2025-12-03（青年路店）
- 酒水销售分析：2025-12-01 至 2025-12-03（万象城店）
- 包厢开台分析：2025-12-01 至 2025-12-03（万象城店）

---

## 一、预订汇总表字段映射

### 1.1 列清单统计

**总列数**: 39列  
**数据行数**: 18行（不含合计行，实际数据行19行含合计）

#### 1.1.1 字段数据质量统计

| 原列名 | 缺失值数量 | 缺失率 | 唯一值数量 | 数据类型 | 示例值 |
|--------|-----------|--------|-----------|---------|--------|
| 部门_Unnamed: 0_level_1 | 0 | 0.00% | 4 | object | 销售经理, 服务员, 收银员 |
| 订位人_Unnamed: 1_level_1 | 1 | 5.56% | 17 | object | 申海宁, 黄锦琪, 黄怡芳 |
| 订台数_Unnamed: 2_level_1 | 0 | 0.00% | 15 | int64 | - |
| 销售金额_Unnamed: 3_level_1 | 0 | 0.00% | 18 | float64 | - |
| 服务费_Unnamed: 4_level_1 | 0 | 0.00% | 1 | int64 | 0（全为0） |
| 自动扣减_Unnamed: 5_level_1 | 0 | 0.00% | 14 | int64 | - |
| 基本业绩_Unnamed: 6_level_1 | 0 | 0.00% | 18 | float64 | - |
| 免单金额_Unnamed: 7_level_1 | 0 | 0.00% | 1 | int64 | 0（全为0） |
| 挂账金额_Unnamed: 8_level_1 | 0 | 0.00% | 1 | int64 | 0（全为0） |
| 调整金额_Unnamed: 9_level_1 | 0 | 0.00% | 1 | int64 | 0（全为0） |
| 折扣金额_Unnamed: 10_level_1 | 0 | 0.00% | 1 | int64 | 0（全为0） |
| 抹零金额_Unnamed: 11_level_1 | 0 | 0.00% | 1 | int64 | 0（全为0） |
| 赠送金额_Unnamed: 12_level_1 | 0 | 0.00% | 16 | int64 | - |
| 应收金额_Unnamed: 13_level_1 | 0 | 0.00% | 18 | float64 | - |
| 实收金额_Unnamed: 14_level_1 | 0 | 0.00% | 18 | float64 | - |
| 支付方式_微信支付 | 0 | 0.00% | 11 | int64 | - |
| 支付方式_支付宝 | 0 | 0.00% | 7 | int64 | - |
| 支付方式_会员支付 | 0 | 0.00% | 16 | float64 | - |
| 支付方式_会员本金 | 0 | 0.00% | 16 | float64 | - |
| 支付方式_会员赠送 | 0 | 0.00% | 15 | float64 | - |
| 支付方式_现金 | 0 | 0.00% | 1 | int64 | 0（全为0） |
| 支付方式_pos银行卡 | 0 | 0.00% | 1 | int64 | 0（全为0） |
| 支付方式_服务员收款 | 0 | 0.00% | 14 | float64 | - |
| 支付方式_员工信用扣款 | 0 | 0.00% | 9 | float64 | - |
| 支付方式_付呗 | 0 | 0.00% | 10 | int64 | - |
| 支付方式_团购 | 0 | 0.00% | 11 | int64 | - |
| 支付方式_店长签单 | 0 | 0.00% | 12 | float64 | - |
| 支付方式_演绎提成 | 0 | 0.00% | 5 | int64 | - |
| 支付方式_抖音 | 0 | 0.00% | 3 | int64 | - |
| 支付方式_POS机 | 0 | 0.00% | 2 | int64 | - |
| 支付方式_营销提成 | 0 | 0.00% | 2 | int64 | - |
| 支付方式_过期取酒 | 0 | 0.00% | 7 | int64 | - |
| 支付方式_招待 | 0 | 0.00% | 4 | int64 | - |
| 支付方式_会员停用 | 0 | 0.00% | 1 | int64 | 0（全为0） |
| 支付方式_三倍充值活动 | 0 | 0.00% | 1 | int64 | 0（全为0） |
| 支付方式_往来款 | 0 | 0.00% | 1 | int64 | 0（全为0） |
| 支付方式_高德 | 0 | 0.00% | 1 | int64 | 0（全为0） |
| 酒水类别金额_过期取酒 | 0 | 0.00% | 7 | int64 | - |
| 酒水类别金额_小计 | 0 | 0.00% | 7 | int64 | - |

**数据质量分析**：
- 大部分字段无缺失值，数据完整性良好
- 订位人字段有1个缺失值（5.56%），为合计行
- 多个支付方式字段全为0，说明该门店未使用这些支付方式
- 服务费、免单、挂账、调整、折扣、抹零等字段全为0，说明该时间段内无此类业务

### 1.2 字段映射表

| 原列名 | 业务字段名 | 数据类型 | 是否必填 | 口径说明 | 版本 | 备注 |
|--------|-----------|---------|---------|---------|------|------|
| 部门_Unnamed: 0_level_1 | department | VARCHAR(50) | 是 | 员工所属部门（销售经理/服务员/收银员等） | v1.0 | 维度字段，需清洗统一 |
| 订位人_Unnamed: 1_level_1 | booking_person | VARCHAR(50) | 是 | 负责订位的员工姓名 | v1.0 | 维度字段，关联员工维表 |
| 订台数_Unnamed: 2_level_1 | booking_count | INTEGER | 是 | 该员工订位的包厢数量 | v1.0 | 计数字段 |
| 销售金额_Unnamed: 3_level_1 | sales_amount | DECIMAL(12,2) | 是 | 销售总金额（元），保留2位小数 | v1.0 | 核心收入指标 |
| 服务费_Unnamed: 4_level_1 | service_fee | DECIMAL(12,2) | 是 | 服务费金额，通常为0 | v1.0 | 金额字段，缺失填0 |
| 自动扣减_Unnamed: 5_level_1 | auto_deduction | DECIMAL(12,2) | 是 | 自动扣减金额（如会员权益等） | v1.0 | 扣减项，影响实收 |
| 基本业绩_Unnamed: 6_level_1 | base_performance | DECIMAL(12,2) | 是 | 基本业绩金额，用于考核 | v1.0 | 核心业绩指标 |
| 免单金额_Unnamed: 7_level_1 | free_amount | DECIMAL(12,2) | 是 | 免单金额，不计入实收 | v1.0 | 扣减项 |
| 挂账金额_Unnamed: 8_level_1 | credit_amount | DECIMAL(12,2) | 是 | 挂账金额，未实际收款 | v1.0 | 扣减项 |
| 调整金额_Unnamed: 9_level_1 | adjustment_amount | DECIMAL(12,2) | 是 | 调整金额（正负均可） | v1.0 | 扣减项 |
| 折扣金额_Unnamed: 10_level_1 | discount_amount | DECIMAL(12,2) | 是 | 折扣金额 | v1.0 | 扣减项 |
| 抹零金额_Unnamed: 11_level_1 | round_off_amount | DECIMAL(12,2) | 是 | 抹零金额 | v1.0 | 扣减项 |
| 赠送金额_Unnamed: 12_level_1 | gift_amount | DECIMAL(12,2) | 是 | 赠送金额 | v1.0 | 扣减项 |
| 应收金额_Unnamed: 13_level_1 | receivable_amount | DECIMAL(12,2) | 是 | 应收总金额 | v1.0 | 应收 = 销售金额 + 其他应收项 |
| 实收金额_Unnamed: 14_level_1 | actual_received | DECIMAL(12,2) | 是 | 实收金额，核心指标 | v1.0 | **实收口径见1.3节** |
| 支付方式_微信支付 | payment_wechat | DECIMAL(12,2) | 是 | 微信支付金额 | v1.0 | 收入类支付 |
| 支付方式_支付宝 | payment_alipay | DECIMAL(12,2) | 是 | 支付宝支付金额 | v1.0 | 收入类支付 |
| 支付方式_会员支付 | payment_member | DECIMAL(12,2) | 是 | 会员支付总金额（含本金+赠送） | v1.0 | **需去重，见1.4节** |
| 支付方式_会员本金 | payment_member_principal | DECIMAL(12,2) | 是 | 会员本金支付金额 | v1.0 | 权益类，不计入实收，与会员赠送去重 |
| 支付方式_会员赠送 | payment_member_gift | DECIMAL(12,2) | 是 | 会员赠送金额 | v1.0 | 权益类，不计入实收 |
| 支付方式_现金 | payment_cash | DECIMAL(12,2) | 是 | 现金支付金额 | v1.0 | 收入类支付 |
| 支付方式_pos银行卡 | payment_pos_card | DECIMAL(12,2) | 是 | POS机银行卡支付金额 | v1.0 | 收入类支付 |
| 支付方式_服务员收款 | payment_waiter | DECIMAL(12,2) | 是 | 服务员收款金额 | v1.0 | 收入类支付 |
| 支付方式_员工信用扣款 | payment_employee_credit | DECIMAL(12,2) | 是 | 员工信用扣款金额 | v1.0 | 成本/权益类，不计入实收 |
| 支付方式_付呗 | payment_fubei | DECIMAL(12,2) | 是 | 付呗支付金额 | v1.0 | 收入类支付 |
| 支付方式_团购 | payment_groupon | DECIMAL(12,2) | 是 | 团购支付金额 | v1.0 | 收入类支付 |
| 支付方式_店长签单 | payment_manager_sign | DECIMAL(12,2) | 是 | 店长签单金额 | v1.0 | **成本/权益类，不计入实收** |
| 支付方式_演绎提成 | payment_performance_commission | DECIMAL(12,2) | 是 | 演绎提成金额 | v1.0 | **成本/权益类，不计入实收** |
| 支付方式_抖音 | payment_douyin | DECIMAL(12,2) | 是 | 抖音支付金额 | v1.0 | 收入类支付 |
| 支付方式_POS机 | payment_pos | DECIMAL(12,2) | 是 | POS机支付金额（通用） | v1.0 | 收入类支付 |
| 支付方式_营销提成 | payment_marketing_commission | DECIMAL(12,2) | 是 | 营销提成金额 | v1.0 | **成本/权益类，不计入实收** |
| 支付方式_过期取酒 | payment_expired_wine | DECIMAL(12,2) | 是 | 过期取酒金额 | v1.0 | **成本/权益类，不计入实收** |
| 支付方式_招待 | payment_entertainment | DECIMAL(12,2) | 是 | 招待金额 | v1.0 | **成本/权益类，不计入实收** |
| 支付方式_会员停用 | payment_member_disabled | DECIMAL(12,2) | 是 | 会员停用金额 | v1.0 | **成本/权益类，不计入实收** |
| 支付方式_三倍充值活动 | payment_triple_recharge | DECIMAL(12,2) | 是 | 三倍充值活动金额 | v1.0 | 权益类，需确认是否计入实收 |
| 支付方式_往来款 | payment_inter_account | DECIMAL(12,2) | 是 | 往来款金额 | v1.0 | 需确认口径 |
| 支付方式_高德 | payment_gaode | DECIMAL(12,2) | 是 | 高德支付金额 | v1.0 | 收入类支付 |
| 酒水类别金额_过期取酒 | beverage_expired_wine | DECIMAL(12,2) | 是 | 酒水类别中过期取酒金额 | v1.0 | 成本类，需确认是否与支付方式重复 |
| 酒水类别金额_小计 | beverage_subtotal | DECIMAL(12,2) | 是 | 酒水类别金额小计 | v1.0 | 汇总字段 |

### 1.3 实收金额口径

**实收金额计算公式**：
```
实收金额 = 销售金额 
         - 免单金额 
         - 挂账金额 
         - 调整金额 
         - 折扣金额 
         - 抹零金额
         = 收入类支付方式合计
```

**注意**：赠送金额不参与实收金额计算，赠送金额已体现在销售金额的构成中。

**收入类支付方式**（计入实收）：
- 微信支付
- 支付宝
- 现金
- pos银行卡
- 服务员收款
- 付呗
- 团购
- 抖音
- POS机
- 高德

**注意**：会员本金不计入实收金额，会员支付属于权益类，需单独处理。

**成本/权益类支付方式**（不计入实收）：
- 会员支付（含会员本金+会员赠送）
- 员工信用扣款
- 店长签单
- 演绎提成
- 营销提成
- 过期取酒
- 招待
- 会员停用

**待确认项**：
- 三倍充值活动：需确认是否计入实收
- 往来款：需确认口径

**会员支付处理说明**：
- 会员支付（含会员本金+会员赠送）属于权益类，不计入实收金额
- 会员支付需与会员本金+会员赠送去重，用于会员权益分析

### 1.4 会员支付去重规则

**问题**：`支付方式_会员支付` 与 `支付方式_会员本金 + 支付方式_会员赠送` 可能存在重复。

**规则**：
- 优先使用 `会员本金 + 会员赠送` 拆分值
- 若 `会员支付` 存在且与拆分值不一致，记录告警
- 实收计算时，会员本金和会员赠送均不计入实收（均属于权益类）
- 会员支付用于会员权益分析，不参与实收金额计算

### 1.5 数据校验规则

**平衡校验**：
```
实收金额 = 销售金额 - 免单 - 挂账 - 折扣 - 抹零 - 调整
实收金额 = 收入类支付方式合计（不含会员本金）
```

**注意**：
- 赠送金额不参与实收计算
- 会员本金不计入收入类支付方式合计

**异常检测**：
- 实收金额为负值
- 支付方式合计与实收金额差异超过阈值（建议1元）
- 会员支付与会员本金+赠送不一致

---

## 二、酒水销售分析表字段映射

### 2.1 列清单统计

**总列数**: 25列（实际统计）  
**数据行数**: 34行（不含合计行，实际数据行35行含合计）

#### 2.1.1 字段数据质量统计

| 原列名 | 缺失值数量 | 缺失率 | 唯一值数量 | 数据类型 | 示例值 |
|--------|-----------|--------|-----------|---------|--------|
| 酒水名称_Unnamed: 0_level_1 | 0 | 0.00% | 34 | object | 台湾香肠, 精美美式薯条, 芥末黄瓜 |
| 类别名称_Unnamed: 1_level_1 | 1 | 2.94% | 10 | object | Fashion小吃, 主食, 其他 |
| 单位_Unnamed: 2_level_1 | 1 | 2.94% | 7 | object | 份, 盒, 元 |
| 区域_Unnamed: 3_level_1 | 1 | 2.94% | 2 | object | KTV区, 派对包 |
| 成本_小计 | 0 | 0.00% | 23 | float64 | - |
| 成本_销售 | 0 | 0.00% | 21 | float64 | - |
| 成本_赠送 | 0 | 0.00% | 9 | float64 | - |
| 利润_Unnamed: 7_level_1 | 0 | 0.00% | 31 | float64 | - |
| 利润率_Unnamed: 8_level_1 | 0 | 0.00% | 27 | float64 | - |
| 合计_数量 | 0 | 0.00% | 17 | int64 | - |
| 合计_金额 | 0 | 0.00% | 31 | float64 | - |
| 销售数量_小计 | 0 | 0.00% | 16 | int64 | - |
| 销售数量_销售 | 0 | 0.00% | 10 | int64 | - |
| 销售数量_套餐子物品 | 0 | 0.00% | 14 | int64 | - |
| 销售数量_例送子物品 | 0 | 0.00% | 1 | int64 | 0（全为0） |
| 销售金额_小计 | 0 | 0.00% | 30 | float64 | - |
| 销售金额_销售 | 0 | 0.00% | 22 | int64 | - |
| 销售金额_套餐子物品 | 0 | 0.00% | 16 | float64 | - |
| 销售金额_例送子物品 | 0 | 0.00% | 1 | int64 | 0（全为0） |
| 赠送数量_小计 | 0 | 0.00% | 7 | int64 | - |
| 赠送数量_赠送 | 0 | 0.00% | 7 | int64 | - |
| 赠送数量_套餐子物品 | 0 | 0.00% | 1 | int64 | 0（全为0） |
| 赠送金额_小计 | 0 | 0.00% | 12 | int64 | - |
| 赠送金额_赠送 | 0 | 0.00% | 12 | int64 | - |
| 赠送金额_套餐子物品 | 0 | 0.00% | 1 | int64 | 0（全为0） |

**数据质量分析**：
- 数据完整性良好，仅类别名称、单位、区域字段在合计行有缺失（2.94%）
- 销售数量_例送子物品、销售金额_例送子物品、赠送数量_套餐子物品、赠送金额_套餐子物品全为0，说明该时间段内无此类业务
- 商品种类丰富，共34种不同商品
- 商品类别共10类：Fashion小吃、主食、其他、凉菜系、副食、卤味小吃、啤酒、悠悠茶香、群果荟萃、饮料

### 2.2 字段映射表

| 原列名 | 业务字段名 | 数据类型 | 是否必填 | 口径说明 | 版本 | 备注 |
|--------|-----------|---------|---------|---------|------|------|
| 酒水名称_Unnamed: 0_level_1 | beverage_name | VARCHAR(100) | 是 | 酒水商品名称 | v1.0 | 维度字段，关联商品维表 |
| 类别名称_Unnamed: 1_level_1 | category_name | VARCHAR(50) | 是 | 商品类别（如Fashion小吃、啤酒、饮料等） | v1.0 | 维度字段 |
| 单位_Unnamed: 2_level_1 | unit | VARCHAR(20) | 是 | 计量单位（份/瓶/听/壶/包等） | v1.0 | 维度字段 |
| 区域_Unnamed: 3_level_1 | area | VARCHAR(50) | 是 | 销售区域（KTV区/派对包等） | v1.0 | 维度字段 |
| 成本_小计 | cost_total | DECIMAL(12,2) | 是 | 成本小计 = 成本_销售 + 成本_赠送 | v1.0 | **成本口径见2.3节** |
| 成本_销售 | cost_sales | DECIMAL(12,2) | 是 | 销售商品的成本 | v1.0 | 成本字段 |
| 成本_赠送 | cost_gift | DECIMAL(12,2) | 是 | 赠送商品的成本 | v1.0 | 成本字段 |
| 利润_Unnamed: 7_level_1 | profit | DECIMAL(12,2) | 是 | 利润 = 销售金额小计 - 成本小计 | v1.0 | 核心指标 |
| 利润率_Unnamed: 8_level_1 | profit_rate | DECIMAL(8,2) | 是 | 利润率（百分比，如4700表示47%） | v1.0 | 计算字段，需除以100 |
| 合计_数量 | total_quantity | INTEGER | 是 | 合计数量 = 销售数量 + 赠送数量 | v1.0 | 计数字段 |
| 合计_金额 | total_amount | DECIMAL(12,2) | 是 | 合计金额 = 销售金额 + 赠送金额 | v1.0 | 金额字段 |
| 销售数量_小计 | sales_qty_total | INTEGER | 是 | 销售数量小计 | v1.0 | 计数字段 |
| 销售数量_销售 | sales_qty_sales | INTEGER | 是 | 正常销售数量 | v1.0 | 计数字段 |
| 销售数量_套餐子物品 | sales_qty_combo | INTEGER | 是 | 套餐子物品销售数量 | v1.0 | 计数字段 |
| 销售数量_例送子物品 | sales_qty_free_combo | INTEGER | 是 | 例送子物品销售数量 | v1.0 | 计数字段 |
| 销售金额_小计 | sales_amount_total | DECIMAL(12,2) | 是 | 销售金额小计（折后） | v1.0 | 核心收入指标 |
| 销售金额_销售 | sales_amount_sales | DECIMAL(12,2) | 是 | 正常销售金额 | v1.0 | 金额字段 |
| 销售金额_套餐子物品 | sales_amount_combo | DECIMAL(12,2) | 是 | 套餐子物品销售金额 | v1.0 | 金额字段 |
| 销售金额_例送子物品 | sales_amount_free_combo | DECIMAL(12,2) | 是 | 例送子物品销售金额 | v1.0 | 金额字段 |
| 赠送数量_小计 | gift_qty_total | INTEGER | 是 | 赠送数量小计 | v1.0 | 计数字段 |
| 赠送数量_赠送 | gift_qty_gift | INTEGER | 是 | 正常赠送数量 | v1.0 | 计数字段 |
| 赠送数量_套餐子物品 | gift_qty_combo | INTEGER | 是 | 套餐子物品赠送数量 | v1.0 | 计数字段 |
| 赠送金额_小计 | gift_amount_total | DECIMAL(12,2) | 是 | 赠送金额小计 | v1.0 | 金额字段 |
| 赠送金额_赠送 | gift_amount_gift | DECIMAL(12,2) | 是 | 正常赠送金额 | v1.0 | 金额字段 |
| 赠送金额_套餐子物品 | gift_amount_combo | DECIMAL(12,2) | 是 | 套餐子物品赠送金额 | v1.0 | 金额字段 |

### 2.3 成本口径说明

**成本计算公式**：
```
成本_小计 = 成本_销售 + 成本_赠送
利润 = 销售金额_小计 - 成本_小计
利润率 = (利润 / 成本_小计) × 100
```

**注意**：
- 成本包含销售成本和赠送成本
- 利润计算基于折后销售金额
- 利润率 = 利润 / 成本_小计 × 100（成本利润率）
- 利润率字段存储为百分比数值（如4700表示47%），使用时需除以100

### 2.4 数据校验规则

**平衡校验**：
```
成本_小计 = 成本_销售 + 成本_赠送
合计_数量 = 销售数量_小计 + 赠送数量_小计
合计_金额 = 销售金额_小计 + 赠送金额_小计
利润 = 销售金额_小计 - 成本_小计
```

**异常检测**：
- 成本为负值
- 利润为负值（需关注）
- 数量与金额不匹配（需按商品单价校验）

---

## 三、包厢开台分析表字段映射

### 3.1 列清单统计

**总列数**: 60列  
**数据行数**: 81行（含合计行）

### 3.2 字段映射表

#### 3.2.1 基础信息字段

| 原列名 | 业务字段名 | 数据类型 | 是否必填 | 口径说明 | 版本 | 备注 |
|--------|-----------|---------|---------|---------|------|------|
| 包厢名称_Unnamed: 0_level_1 | room_name | VARCHAR(50) | 是 | 包厢名称（如K01、K07、KKK等） | v1.0 | 维度字段，关联包厢维表 |
| 包厢类型_Unnamed: 1_level_1 | room_type | VARCHAR(50) | 是 | 包厢类型（电音中包/电音小包/电音大包/派对包等） | v1.0 | 维度字段 |
| 区域名称_Unnamed: 2_level_1 | area_name | VARCHAR(50) | 是 | 区域名称（KTV区/派对包等） | v1.0 | 维度字段 |
| 开台单号_Unnamed: 3_level_1 | order_no | VARCHAR(50) | 是 | 开台单号（唯一标识，如Z-KT25120200041） | v1.0 | 业务主键 |
| 开房计费模式_Unnamed: 4_level_1 | billing_mode | VARCHAR(100) | 否 | 开房计费模式（如"线上黄金档3H纯唱"） | v1.0 | 维度字段 |
| 开房时间_Unnamed: 5_level_1 | open_time | TIMESTAMP | 是 | 开房时间，格式：YYYY-MM-DD HH:MM:SS | v1.0 | 时间字段，需统一时区 |
| 关房时间_Unnamed: 6_level_1 | close_time | TIMESTAMP | 否 | 关房时间 | v1.0 | 时间字段，可为空 |
| 清洁时间_Unnamed: 7_level_1 | clean_time | TIMESTAMP | 否 | 清洁时间 | v1.0 | 时间字段，可为空 |
| 营业日_Unnamed: 8_level_1 | business_date | DATE | 是 | 营业日（日期，如2025-12-02） | v1.0 | 维度字段，用于分区 |
| 订房人_Unnamed: 9_level_1 | booking_person | VARCHAR(50) | 否 | 订房人姓名 | v1.0 | 维度字段 |
| 订房人部门_Unnamed: 10_level_1 | booking_department | VARCHAR(50) | 否 | 订房人部门 | v1.0 | 维度字段 |
| 返房人_Unnamed: 11_level_1 | return_person | VARCHAR(50) | 否 | 返房人姓名 | v1.0 | 维度字段 |
| 轮房人_Unnamed: 12_level_1 | rotation_person | VARCHAR(50) | 否 | 轮房人姓名 | v1.0 | 维度字段 |
| 商秘/外联_Unnamed: 13_level_1 | business_secretary | VARCHAR(50) | 否 | 商秘/外联人员 | v1.0 | 维度字段 |
| 消费时长_Unnamed: 14_level_1 | duration_minutes | INTEGER | 是 | 消费时长（分钟） | v1.0 | 计算字段，需从时间差计算 |
| 时段_Unnamed: 15_level_1 | time_period | VARCHAR(50) | 否 | 时段（黄金档/白天档/整档等） | v1.0 | 维度字段 |
| 开房标签_Unnamed: 16_level_1 | room_tag | VARCHAR(50) | 否 | 开房标签 | v1.0 | 维度字段 |
| 预订渠道_Unnamed: 17_level_1 | booking_channel | VARCHAR(50) | 否 | 预订渠道 | v1.0 | 维度字段 |
| 账单备注_Unnamed: 18_level_1 | bill_remark | TEXT | 否 | 账单备注 | v1.0 | 文本字段 |

#### 3.2.2 金额字段

| 原列名 | 业务字段名 | 数据类型 | 是否必填 | 口径说明 | 版本 | 备注 |
|--------|-----------|---------|---------|---------|------|------|
| 账单合计_Unnamed: 19_level_1 | bill_total | DECIMAL(12,2) | 是 | 账单合计金额 | v1.0 | 金额字段 |
| 应收金额_Unnamed: 20_level_1 | receivable_amount | DECIMAL(12,2) | 是 | 应收金额 | v1.0 | 金额字段 |
| 实收金额_Unnamed: 21_level_1 | actual_received | DECIMAL(12,2) | 是 | 实收金额，核心指标 | v1.0 | **实收口径见3.3节** |
| 赠送_Unnamed: 22_level_1 | gift_amount | DECIMAL(12,2) | 是 | 赠送金额 | v1.0 | 扣减项 |
| 抹零金额_Unnamed: 23_level_1 | round_off_amount | DECIMAL(12,2) | 是 | 抹零金额 | v1.0 | 扣减项 |
| 调整金额_Unnamed: 24_level_1 | adjustment_amount | DECIMAL(12,2) | 是 | 调整金额 | v1.0 | 扣减项 |
| 挂账金额_Unnamed: 25_level_1 | credit_amount | DECIMAL(12,2) | 是 | 挂账金额 | v1.0 | 扣减项 |
| 免单金额_Unnamed: 26_level_1 | free_amount | DECIMAL(12,2) | 是 | 免单金额 | v1.0 | 扣减项 |
| 房费折扣金额_Unnamed: 27_level_1 | room_discount | DECIMAL(12,2) | 是 | 房费折扣金额 | v1.0 | 扣减项 |
| 酒水折扣金额_Unnamed: 28_level_1 | beverage_discount | DECIMAL(12,2) | 是 | 酒水折扣金额 | v1.0 | 扣减项 |
| 基本业绩_Unnamed: 29_level_1 | base_performance | DECIMAL(12,2) | 是 | 基本业绩金额，用于考核 | v1.0 | 核心业绩指标 |
| 低消费_Unnamed: 30_level_1 | min_consumption | DECIMAL(12,2) | 否 | 低消费金额 | v1.0 | 金额字段 |
| 低消差额_Unnamed: 31_level_1 | min_consumption_diff | DECIMAL(12,2) | 否 | 低消差额 | v1.0 | 金额字段 |
| 计入低消金额_Unnamed: 32_level_1 | included_min_consumption | DECIMAL(12,2) | 否 | 计入低消金额 | v1.0 | 金额字段 |
| 不计入低消金额_Unnamed: 33_level_1 | excluded_min_consumption | DECIMAL(12,2) | 否 | 不计入低消金额 | v1.0 | 金额字段 |
| 特饮金额_Unnamed: 34_level_1 | special_drink_amount | DECIMAL(12,2) | 否 | 特饮金额 | v1.0 | 金额字段 |
| 销售经理_Unnamed: 35_level_1 | sales_manager | VARCHAR(50) | 否 | 销售经理姓名 | v1.0 | 维度字段 |
| 营销经理_Unnamed: 36_level_1 | marketing_manager | VARCHAR(50) | 否 | 营销经理姓名 | v1.0 | 维度字段 |

#### 3.2.3 支付方式字段

| 原列名 | 业务字段名 | 数据类型 | 是否必填 | 口径说明 | 版本 | 备注 |
|--------|-----------|---------|---------|---------|------|------|
| 支付方式_微信支付 | payment_wechat | DECIMAL(12,2) | 否 | 微信支付金额 | v1.0 | 收入类支付，缺失率84.81% |
| 支付方式_支付宝 | payment_alipay | DECIMAL(12,2) | 否 | 支付宝支付金额 | v1.0 | 收入类支付，缺失率94.94% |
| 支付方式_会员支付 | payment_member | DECIMAL(12,2) | 否 | 会员支付总金额（含本金+赠送） | v1.0 | **需去重，见3.4节**，缺失率51.90% |
| 支付方式_会员本金 | payment_member_principal | DECIMAL(12,2) | 否 | 会员本金支付金额 | v1.0 | 权益类，不计入实收，与会员赠送去重，缺失率51.90% |
| 支付方式_会员赠送 | payment_member_gift | DECIMAL(12,2) | 否 | 会员赠送金额 | v1.0 | 权益类，不计入实收，缺失率51.90% |
| 支付方式_现金 | payment_cash | DECIMAL(12,2) | 否 | 现金支付金额 | v1.0 | 收入类支付，缺失率72.15% |
| 支付方式_银行卡 | payment_bank_card | DECIMAL(12,2) | 否 | 银行卡支付金额 | v1.0 | 收入类支付，缺失率98.73% |
| 支付方式_服务员收款 | payment_waiter | DECIMAL(12,2) | 否 | 服务员收款金额 | v1.0 | 收入类支付，缺失率84.81% |
| 支付方式_员工信用扣款 | payment_employee_credit | DECIMAL(12,2) | 否 | 员工信用扣款金额 | v1.0 | 成本/权益类，不计入实收，缺失率98.73% |
| 支付方式_付呗 | payment_fubei | DECIMAL(12,2) | 否 | 付呗支付金额 | v1.0 | 收入类支付，缺失率97.47% |
| 支付方式_店长签单 | payment_manager_sign | DECIMAL(12,2) | 否 | 店长签单金额 | v1.0 | **成本/权益类，不计入实收**，缺失率92.41% |
| 支付方式_演绎提成 | payment_performance_commission | DECIMAL(12,2) | 否 | 演绎提成金额 | v1.0 | **成本/权益类，不计入实收**，缺失率98.73% |
| 支付方式_营销提成 | payment_marketing_commission | DECIMAL(12,2) | 否 | 营销提成金额 | v1.0 | **成本/权益类，不计入实收**，缺失率98.73% |
| 支付方式_过期取酒 | payment_expired_wine | DECIMAL(12,2) | 否 | 过期取酒金额 | v1.0 | **成本/权益类，不计入实收**，缺失率98.73% |
| 支付方式_美团 | payment_meituan | DECIMAL(12,2) | 否 | 美团支付金额 | v1.0 | 收入类支付，缺失率59.49% |
| 支付方式_抖音 | payment_douyin | DECIMAL(12,2) | 否 | 抖音支付金额 | v1.0 | 收入类支付，缺失率94.94% |
| 支付方式_招待 | payment_entertainment | DECIMAL(12,2) | 否 | 招待金额 | v1.0 | **成本/权益类，不计入实收**，缺失率98.73% |
| 支付方式_扫码 | payment_scan | DECIMAL(12,2) | 否 | 扫码支付金额 | v1.0 | 收入类支付，缺失率98.73% |
| 支付方式_会员停用 | payment_member_disabled | DECIMAL(12,2) | 否 | 会员停用金额 | v1.0 | **成本/权益类，不计入实收**，缺失率98.73% |
| 支付方式_三倍储值活动 | payment_triple_recharge | DECIMAL(12,2) | 否 | 三倍储值活动金额 | v1.0 | 权益类，需确认是否计入实收，缺失率98.73% |
| 支付方式_定金消费 | payment_deposit | DECIMAL(12,2) | 否 | 定金消费金额 | v1.0 | 需确认口径，缺失率98.73% |
| 支付方式_高德 | payment_gaode | DECIMAL(12,2) | 否 | 高德支付金额 | v1.0 | 收入类支付，缺失率98.73% |

**注意**：包厢开台分析表的支付方式字段与预订汇总表存在差异：
- 包厢开台表使用"支付方式_银行卡"而非"支付方式_pos银行卡"
- 包厢开台表有"支付方式_美团"和"支付方式_扫码"，预订汇总表没有
- 包厢开台表使用"支付方式_三倍储值活动"而非"支付方式_三倍充值活动"
- 包厢开台表有"支付方式_定金消费"，预订汇总表没有

### 3.3 实收金额口径

**实收金额计算公式**：
```
实收金额 = 账单合计 
         - 抹零金额 
         - 调整金额 
         - 挂账金额 
         - 免单金额 
         - 房费折扣金额 
         - 酒水折扣金额
         - 权益类支付方式合计
         = 收入类支付方式合计
```

**注意**：
- 赠送金额不参与实收金额计算，赠送金额已体现在账单合计的构成中
- 权益类支付方式合计 = 会员支付 + 员工信用扣款 + 店长签单 + 演绎提成 + 营销提成 + 过期取酒 + 招待 + 会员停用

**收入类支付方式**（计入实收）：
- 微信支付
- 支付宝
- 现金
- 银行卡
- 服务员收款
- 付呗
- 美团
- 抖音
- 扫码
- 高德

**注意**：会员本金不计入实收金额，会员支付属于权益类，需单独处理。

**成本/权益类支付方式**（不计入实收）：
- 会员支付（含会员本金+会员赠送）
- 员工信用扣款
- 店长签单
- 演绎提成
- 营销提成
- 过期取酒
- 招待
- 会员停用

**待确认项**：
- 三倍储值活动：需确认是否计入实收
- 定金消费：需确认口径

**会员支付处理说明**：
- 会员支付（含会员本金+会员赠送）属于权益类，不计入实收金额
- 会员支付需与会员本金+会员赠送去重，用于会员权益分析

### 3.4 会员支付去重规则

**问题**：`支付方式_会员支付` 与 `支付方式_会员本金 + 支付方式_会员赠送` 可能存在重复。

**规则**：
- 优先使用 `会员本金 + 会员赠送` 拆分值
- 若 `会员支付` 存在且与拆分值不一致，记录告警
- 实收计算时，会员本金和会员赠送均不计入实收（均属于权益类）
- 会员支付用于会员权益分析，不参与实收金额计算

### 3.5 数据校验规则

**平衡校验**：
```
实收金额 = 账单合计 - 抹零 - 调整 - 挂账 - 免单 - 房费折扣 - 酒水折扣 - 权益类支付方式合计
实收金额 = 收入类支付方式合计（不含会员本金）
```

**注意**：
- 赠送金额不参与实收计算
- 会员本金不计入收入类支付方式合计
- 权益类支付方式合计需要从账单合计中扣除

**异常检测**：
- 实收金额为负值
- 支付方式合计与实收金额差异超过阈值（建议1元）
- 会员支付与会员本金+赠送不一致
- 开房时间晚于关房时间
- 关房时间晚于清洁时间

### 3.6 字段数据质量统计

| 字段类别 | 缺失率统计 | 说明 |
|---------|-----------|------|
| 基础信息字段 | 0-5.06% | 大部分字段完整，开房计费模式缺失率5.06% |
| 人员信息字段 | 100% | 订房人、订房人部门、返房人、轮房人、商秘/外联、销售经理、营销经理全部缺失 |
| 时间字段 | 0-21.52% | 开房时间、关房时间、营业日缺失率低（1.27%），清洁时间缺失率21.52% |
| 金额字段 | 0-37.97% | 核心金额字段完整，低消相关字段缺失率37.97% |
| 支付方式字段 | 51.90%-98.73% | 大部分支付方式字段缺失率高，说明该门店主要使用少数几种支付方式 |

**数据质量分析**：
- 核心业务字段（包厢名称、开台单号、开房时间、账单金额、实收金额）完整性良好
- 人员信息字段全部缺失，说明该门店可能未启用人员管理功能
- 支付方式字段缺失率高，但这是正常的业务现象（不同门店使用不同支付方式）
- 清洁时间缺失率21.52%，说明部分订单未记录清洁时间

---

## 四、数据质量汇总分析

### 4.1 三表数据质量对比

| 表名 | 总列数 | 数据行数 | 平均缺失率 | 核心字段完整性 | 数据质量评级 |
|------|--------|---------|-----------|---------------|-------------|
| 预订汇总 | 39 | 18 | 0.14% | 优秀 | A |
| 酒水销售分析 | 25 | 34 | 0.12% | 优秀 | A |
| 包厢开台分析 | 59 | 79 | 45.23% | 良好 | B |

**说明**：
- 预订汇总表和酒水销售分析表数据质量优秀，核心字段完整
- 包厢开台分析表缺失率较高，主要因为人员信息字段和部分支付方式字段全部缺失，但核心业务字段完整

### 4.2 字段映射版本管理

**当前版本**: v1.0  
**版本日期**: 2025-12-03  
**版本说明**: 基于三个样例文件生成的初始字段映射规范

**版本变更记录**：
- v1.0 (2025-12-03): 初始版本，包含三表完整字段映射、数据质量统计、实收口径说明

### 4.3 待确认事项清单

1. **实收口径确认**：
   - [ ] 三倍充值活动/三倍储值活动是否计入实收
   - [ ] 往来款口径确认
   - [ ] 定金消费口径确认

2. **字段差异确认**：
   - [ ] 预订汇总表与包厢开台表的支付方式字段差异是否需要统一
   - [ ] 酒水类别金额_过期取酒与支付方式_过期取酒是否重复

3. **数据质量改进**：
   - [ ] 包厢开台分析表人员信息字段缺失是否需要补录
   - [ ] 清洁时间缺失是否需要补录

### 4.4 字段映射表导出格式

**建议导出格式**：
- CSV格式：便于导入数据库映射表
- JSON格式：便于程序读取和版本管理
- YAML格式：便于配置管理

**字段映射表结构**：
```sql
CREATE TABLE field_mapping (
    id SERIAL PRIMARY KEY,
    table_type VARCHAR(50) NOT NULL,  -- 表类型：booking_summary/beverage_sales/room_analysis
    original_column_name VARCHAR(200) NOT NULL,
    business_field_name VARCHAR(100) NOT NULL,
    data_type VARCHAR(50) NOT NULL,
    is_required BOOLEAN DEFAULT FALSE,
    description TEXT,
    version VARCHAR(20) DEFAULT 'v1.0',
    remarks TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

---

## 五、附录

### 5.1 字段命名规范

- **业务字段名**：使用小写字母和下划线，遵循snake_case命名规范
- **数据类型**：遵循SQL标准数据类型
- **版本号**：使用语义化版本号（v1.0, v1.1等）

### 5.2 数据清洗建议

1. **维度字段清洗**：
   - 部门、员工姓名：统一大小写，去除前后空格
   - 包厢名称：统一格式（如K01、K07等）
   - 商品名称：建立商品维表，统一商品名称

2. **金额字段清洗**：
   - 缺失值填充为0
   - 保留2位小数
   - 负值检查（除调整金额外，其他金额不应为负）

3. **时间字段清洗**：
   - 统一时区
   - 格式化为ISO8601格式
   - 时长统一转换为分钟

### 5.3 参考文档

- 《各张表字段.md》：原始字段说明
- 《具体需求.md》：业务需求说明
- 《详细业务分析实现.md》：技术实施方案